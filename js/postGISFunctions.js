//Police Station icon
var policeIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div class='marker-pin police-pin'><i class='divIcon fas fa-shield-alt awesome'></i></div>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });

//Fire Station icon
var fireIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div class='marker-pin fire-pin'><i class='divIcon fab fa-gripfire awesome'></i></div>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
	
//Hospital icon
var hospitalIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div class='marker-pin hospital-pin'><i class='divIcon fas fa-hospital-symbol awesome'></i></div>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
	
//Health Center icon
var health_centerIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div class='marker-pin health_center-pin'><i class='divIcon fas fa-clinic-medical awesome'></i></div>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });

//Prison icon
var prisonIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div class='marker-pin prison-pin'><i class='divIcon fas fa-exclamation-circle awesome'></i></div>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });	
//Elem Schools icon
var elemSchoolsIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<!--<div class='marker-pin elem_schools-pin'>--><i class='divIcon elem fas fa-school awesome'></i><!--</div>-->",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
	
//Jr High Schools icon
var jrHighSchoolsIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<!--<div class='marker-pin jr_schools-pin'>--><i class='divIcon jrhigh fas fa-school awesome'></i><!--</div>-->",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
	
//High Schools icon
var highSchoolsIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<!--<div class='marker-pin high_schools-pin'>--><i class='divIcon high fas fa-school awesome'></i><!--</div>-->",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
	
//Post Secondary Schools icon
var postSecSchoolsIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div class='marker-pin post_sec_schools-pin'><i class='divIcon fas fa-graduation-cap awesome'></i></div>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
	
//Bus Stop icon
var busStopIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div class='marker-pin bus_stop-pin'><i class='divIcon fas fa-bus awesome'></i></div>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
	
//LRT Stop icon
var lrtStationIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div class='marker-pin lrt_stop-pin'><i class='divIcon fas fa-subway awesome'></i></div>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
//Library icon
var librariesIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div class='marker-pin library-pin'><i class='divIcon fas fa-book-reader awesome'></i></div>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
//Entertainment icon
var entertainmentIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div class='marker-pin entertain-pin'><i class='divIcon fas fa-landmark awesome'></i></div>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
//ComCenter icon
var comCenterIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<!--<div class='marker-pin com_center-pin'>--><i class='divIcon fas fa-users awesome'></i><!--</div>-->",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
//Entertainment icon
var waterSportIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div class='marker-pin swimmer-pin'><i class='divIcon fas fa-swimmer awesome'></i></div>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
//Gas Station icon
var mallIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin malls-pin'></div><i class='divIcon fas fa-shopping-bag awesome'></i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
//Gas Station icon
var groceryIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin grocery-pin'></div><i class='divIcon fas fa-carrot awesome'></i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
//Gas Station icon
var restaurantIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin restaurant-pin'></div><i class='divIcon fas fa-utensils awesome'></i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
//Gas Station icon
var gasStationIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin gas_station-pin'></div><i class='divIcon fas fa-gas-pump awesome'></i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
//Play structure icon
var playStructureIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin play_structure-pin'></div><i class='divIcon fas fa-child awesome'></i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });

//Tennis icon
var tennisIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin tennis-pin'></div><i class='divIcon fab fa-affiliatetheme awesome'></i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
//soccer icon
var soccerIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin soccer-pin'></div><i class='divIcon fas fa-futbol awesome'></i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
//soccer/football icon
var socFootIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin socFoot-pin'></div><i class='divIcon fas letters awesome'>S/F</i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
//Ban icon
var banIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin skateboard-pin'></div><i class='divIcon fas fa-ban awesome'></i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
//Football icon
var footballIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin football-pin'></div><i class='divIcon fas fa-football-ball awesome'></i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
//Baseball icon
var baseballIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin baseball-pin'></div><i class='divIcon fas fa-baseball-ball awesome'></i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
//Basketball icon
var basketballIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin basketball-pin'></div><i class='divIcon fas fa-basketball-ball awesome'></i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
//Volleyball icon
var volleyballIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin volleyball-pin'></div><i class='divIcon fas fa-volleyball-ball awesome'></i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
//Hockey icon
var hockeyIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin hockey-pin'></div><i class='divIcon fas fa-hockey-puck awesome'></i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });	
//Skating icon
var skateIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin skating-pin'></div><i class='divIcon fas fa-skating awesome'></i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });	
//Swimming icon
var swimIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin swim-pin'></div><i class='divIcon fas fa-swimmer awesome'></i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });	
//Frisbee icon
var frisbeeIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin frisbee-pin'></div><i class='divIcon fas fa-compact-disc awesome'></i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });	
//Sled icon
var sledIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin sled-pin'></div><i class='divIcon fas fa-sleigh awesome'></i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
//Runner icon
var runnerIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin runner-pin'></div><i class='divIcon fas fa-running awesome'></i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });	
	
//Real Estate icon
var realEstateIcon = L.divIcon({
				className: 'custom-div-icon',
        html: "<div  class='marker-pin home-pin'></div><i class='divIcon fas fa-home awesome'></i>",
        iconSize: [30, 42],
        iconAnchor: [15, 42]
    });
	
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function recParkPolyStyle(feature) {
    return {
        fillColor: '#7aff70',
        weight: 1,
        opacity: 1,
        color: 'black',
        dashArray: '3',
        fillOpacity: 0.8
    };
}

function waterTreatmentPolyStyle(feature) {
    return {
        fillColor: "#d3ff4c",
        weight: 3,
        opacity: 1,
        color: 'black',
        dashArray: '3',
        fillOpacity: 0.7
    };
}

function powerPolyStyle(feature) {
    return {
        fillColor: "#f56342",
        weight: 1,
        opacity: 1,
        color: '#f56342',
        dashArray: '3',
        fillOpacity: 0.8
    };
}
function floodPolyStyle(feature) {
    return {
        fillColor: "#21f4ff",
        weight: 1,
        opacity: 1,
        color: '#000',
        dashArray: '3',
        fillOpacity: 0.8
    };
}

function trainLineStyle(feature) {
    return {
        weight: 4,
        opacity: 1,
        color: '#fff200'
    };
}

function roadLineStyle(feature) {
    return {
        weight: 4,
        opacity: 1,
        color: '#ff9721'
    };
}
function recTrailsLineStyle(feature) {
    return {
        weight: 4,
        opacity: 1,
        color: '#1e29fa'
    };
}
  
 function dogParkStyle (feature) {
    return {
        fillColor: "#52eb47",
        weight: 2,
        opacity: 1,
        color: 'brown',
        dashArray: '3',
        fillOpacity: 0.7
    };
}
//Red Color Ramp
//Light ['#feedde','#fdbe85','#fd8d3c','#e6550d','#a63603'] Dark
	function getRedColor(d) {
    return d== "Not Available"  ?  '#000' :
		   d > 20   ? '#FF0000' :
           d > 15   ? '#fa6466' :
           d > 10   ? '#FF7F81' :
           d > 5   ? '#FFA9AC' :
                      '#FFD4D7';
}

	function redStyle(feature) {
    return {
        fillColor: getRedColor(feature.properties.total_style),
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 0.7
    };
}

/*Landfill*/
function landfillStyle(feature) {
    return {
        fillColor: '#00d400',
        weight: 1,
        opacity: 1,
        color: '#000',
        fillOpacity: 0.7
    };
}

/*Cemetery*/
function cemeteryPolyStyle(feature) {
    return {
        fillColor: '#bf941d',
        weight: 1,
        opacity: 1,
        color: '#bf941d',
        fillOpacity: 0.9
    };
}

//Sports Ramp
//Light ['#feedde','#fdbe85','#fd8d3c','#e6550d','#a63603'] Dark
	function getSportsColor(d) {
    return d== "Not Available"  ?  '#000' :
		   d > 20   ? '#6af041' :
           d > 15   ? '#f1f014' :
           d > 10   ? '#f7a20a' :
           d > 5   ? '#ff2c2c' :
                      '#932c2c';
}

	function sportsStyle(feature) {
    return {
        fillColor: getSportsColor(feature.properties.total_style),
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 0.7
    };
}

//Ind Income Color Ramp
//Light ['#feedde','#fdbe85','#fd8d3c','#e6550d','#a63603'] Dark
	function getIndIncomeColor(d) {
    return d== "Not Available"  ?  '#000' :
		   d > 70000   ? '#99038b' :
           d > 50000   ? '#c24ab3' :
           d > 35000   ? '#ebaee0' :
                      '#ffd4f5';
}

	function indIncomeStyle(feature) {
    return {
        fillColor: getIndIncomeColor(feature.properties.income),
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 0.7
    };
}

//Household Income Color Ramp
//Light ['#feedde','#fdbe85','#fd8d3c','#e6550d','#a63603'] Dark
	function getHouseIncomeColor(d) {
    return d== "Not Available"  ?  '#000' :
           d > 200000   ? '#99038b' :
           d > 150000   ? '#c24ab3' :
           d > 100000   ? '#d67ac9' :
           d > 50000   ? '#ebaee0' :
                      '#ffd4f5';
}

	function houseIncomeStyle(feature) {
    return {
        fillColor: getHouseIncomeColor(feature.properties.income),
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 0.8
    };
}

//Crime Color Ramp
//Light ['#feedde','#fdbe85','#fd8d3c','#e6550d','#a63603'] Dark
	function getPropertyCrimeColor(d) {
    return d== "Not Available"  ?  '#000' :
           d > 70   ? '#FE2E08' :
           d > 50   ? '#FD8B1A' :
           d > 30   ? '#FDBA23' :
           d > 10   ? '#FDE92C' :
                      '#abff57';
}

	function propertyCrimeStyle(feature) {
    return {
        fillColor: getPropertyCrimeColor(feature.properties.crimes),
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 0.8
    };
}

function getOverallCrimeColor(d) {
    return d== "Not Available"  ?  '#000' :
           d > 100   ? '#FE2E08' :
           d > 75   ? '#FD8B1A' :
           d > 50   ? '#FDBA23' :
           d > 25   ? '#FDE92C' :
                      '#abff57';
}

	function overallCrimeStyle(feature) {
    return {
        fillColor: getOverallCrimeColor(feature.properties.crimes),
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 0.8
    };
}

//Ind Income Color Ramp
//Light ['#feedde','#fdbe85','#fd8d3c','#e6550d','#a63603'] Dark
	function getAvgHouseColor(d) {
    return d== "Not Available"  ?  '#000' :
		   d > 1000000   ? '#99038b' :
           d > 750000   ? '#c24ab3' :
           d > 500000   ? '#d67ac9' :
           d > 250000   ? '#ebaee0' :
                      '#ffd4f5';
}

	function avgHousePriceStyle(feature) {
    return {
        fillColor: getAvgHouseColor(feature.properties.avg_price),
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 0.9
    };
}

// Calls PHP/PostGIS function to look up community for lat/lng
function findCommunity(latitude, longitude){
	map.spin(true);
	$.ajax({
		type: "POST",
        url: "https://mapyyc.gis-cdn.net/publicMap/php/ST_Within_Point_Community.php",
			data: {longitude: longitude, latitude: latitude},
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				var bounds = L.latLngBounds([]);				
				bounds.extend(L.latLng([latitude, longitude]));
				
				if (searchMarker != undefined) {
					map.removeLayer(searchMarker);
				};
				
				searchMarker = L.marker([latitude, longitude]).addTo(map);
				
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: defaultPointStyle,
					onEachFeature: function (feature, layer) {
						alert(feature.properties.name);						
						//layer.bindPopup('Name: '+ feature.properties.tradename + '<br> Address: ' + feature.properties.address + '<br> Type: ' + feature.properties.licencetyp).openPopup();
						
					}
				}).addTo(map);
				
				var layerBounds = queryLayer.getBounds();
				bounds.extend(layerBounds);
				map.fitBounds(bounds);
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	}); 
}

// Calls PHP/PostGIS function to look up community for lat/lng
function saveLocation(locationToSave){
	map.spin(true);
	$.ajax({
		type: "POST",
        url: "https://mapyyc.gis-cdn.net/publicMap/php/SaveUserLocation.php",
			data: {locationToSave: locationToSave},
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				var bounds = L.latLngBounds([]);				
				bounds.extend(L.latLng([latitude, longitude]));
				
				if (searchMarker != undefined) {
					map.removeLayer(searchMarker);
				};
				
				searchMarker = L.marker([latitude, longitude]).addTo(map);
				
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: defaultPointStyle,
					onEachFeature: function (feature, layer) {
						alert(feature.properties.address);						
						//layer.bindPopup('Name: '+ feature.properties.tradename + '<br> Address: ' + feature.properties.address + '<br> Type: ' + feature.properties.licencetyp).openPopup();
						
					}
				}).addTo(map);
				
				var layerBounds = queryLayer.getBounds();
				bounds.extend(layerBounds);
				map.fitBounds(bounds);
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	}); 
}

//Save Location Button for popup
var template = '<button id="button-submit" type="button">Save Location</button>';

function popupSaveHandler (e) {
	var marker = e.target,
    properties = e.target.feature.properties;
	
	//alert("Latitude "+ properties.latitude);
	
	var str = properties.city_postal;
	var city = str.split(" ");
	
	marker.bindPopup('REAL ESTATE <br/> Address: '+ properties.address + '<br> City: ' + city[0] + '<br> Community: ' + properties.community + '<br> List Price: ' + properties.list_price + '<br>'+ template).openPopup();
						
	
	var buttonSubmit = L.DomUtil.get('button-submit');
	L.DomEvent.addListener(buttonSubmit, 'click', function (e) {
		//removeActiveLocation();
		var tempLocation= new Location(true, properties.address, properties.community, properties.latitude, properties.longitude);
		updateLocation(tempLocation);
		addLocationToList(tempLocation);
		
		//marker.closePopup();
		//alert("Latitude "+ properties.latitude);
	});
	  
}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//Function for loading layers from PostGRES
var activeLayerStats = null;

function postSwitch(lName){
	//alert("Switch");
	activeLayerStats = lName;
	
	menuIconFunction();
	
	var longitude = document.getElementById("longitude").value;
	var latitude = document.getElementById("latitude").value;
	
switch (true) {
  case (lName==="es1"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/safety/police_stations_RA.php",
			data: {longitude: longitude, latitude: latitude},	
			cache: false,
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendPolice);
				
				addRemoveLayertoLegend();
				
				//Show stats for layer
				menuStatsFunction();				
				//updateStats();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: policeIcon});
					},
					onEachFeature: function (feature, layer) {
						//name, station_ty, address, community
												
						layer.bindPopup('POLICE STATION <br/> Name: '+ feature.properties.name + '<br> Address: ' + feature.properties.address + '<br> Type: ' + feature.properties.station_ty + '<br> Community: ' + feature.properties.community).openPopup();
					}
				}).addTo(map);
				
				var layerBounds = queryLayer.getBounds();
				var bounds = map.getBounds();
				bounds.extend(layerBounds);
				map.flyToBounds(bounds);
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
	
    break;
	case (lName==="es2"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/safety/fire_stations_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendFire); 
				
				//console.log(response);
				addRemoveLayertoLegend();
				
				//Show stats for layer
				menuStatsFunction();				
				//updateStats();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: fireIcon});
					},
					onEachFeature: function (feature, layer) {
						//geom, name, address, type, community

												
						layer.bindPopup('FIRE STATION <br/> Name: '+ feature.properties.name + '<br> Address: ' + feature.properties.address + '<br> Type: ' + feature.properties.type + '<br> Community: ' + feature.properties.community).openPopup();
					}
				}).addTo(map);
				
				var layerBounds = queryLayer.getBounds();
				var bounds = map.getBounds();
				bounds.extend(layerBounds);
				map.flyToBounds(bounds);
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="es4"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/safety/hospitals_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendHospital); 
				
				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: hospitalIcon});
					},
					onEachFeature: function (feature, layer) {
						//geom, name, address, type, community
												
						layer.bindPopup('HOSPITAL <br/> Name: '+ feature.properties.name + '<br> Address: ' + feature.properties.address + '<br> Type: ' + feature.properties.type + '<br> Community: ' + feature.properties.community).openPopup();
					}
				}).addTo(map);
				
				var layerBounds = queryLayer.getBounds();
				var bounds = map.getBounds();
				bounds.extend(layerBounds);
				map.flyToBounds(bounds);
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	}); 
    break;
	case (lName==="es3"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/services/health_centers_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendHealthCenter); 
				
				//console.log(response);				
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: health_centerIcon});
					},
					onEachFeature: function (feature, layer) {
						//geom, name, address, type, community

												
						layer.bindPopup('HEALTH CENTER <br/> Name: '+ feature.properties.name + '<br> Address: ' + feature.properties.address + '<br> Type: ' + feature.properties.type + '<br> Community: ' + feature.properties.community).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="es5"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/safety/prisons_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendPrison); 
				
				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: prisonIcon});
					},
					onEachFeature: function (feature, layer) {
						//geom, name, address, type, community
												
						layer.bindPopup('CORRECTIONAL FACILITY <br/> Name: '+ feature.properties.name + '<br> Prison Capacity: ' + feature.properties.capacity + '<br> Community: ' + feature.properties.community).openPopup();
					}
				}).addTo(map);
				
				var layerBounds = queryLayer.getBounds();
				var bounds = map.getBounds();
				bounds.extend(layerBounds);
				map.flyToBounds(bounds);
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	}); 
    break;
	case (lName==="es6"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/safety/1in100_flood_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendFlood); 
				
				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: floodPolyStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, scenario, area
												
						layer.bindPopup('FLOOD RISK <br/> Risk Scenario: '+ feature.properties.scenario + '<br> Area (acres): ' + feature.properties.area).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="cr1"):
	map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/safety/property_crime_counts_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendPropertyCrime); 
				
				//console.log(response);	
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: propertyCrimeStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, name, type, crimes

												
						layer.bindPopup('PROPERTY CRIME COUNTS <br/> Community: '+ feature.properties.name + '<br> Type of Crime: ' + feature.properties.type + '<br> # of Related Crimes: ' + feature.properties.crimes).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="cr2"):
	map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/safety/violent_crime_counts_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendViolentCrime); 
				
				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: propertyCrimeStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, name, type, crimes

												
						layer.bindPopup('VIOLENT CRIME COUNTS <br/> Community: '+ feature.properties.name + '<br> Type of Crime: ' + feature.properties.type + '<br> # of Related Crimes: ' + feature.properties.crimes).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="cr3"):
	map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/safety/overall_crime_counts_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendOverallCrime); 
				
				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: overallCrimeStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, name, type, crimes

												
						layer.bindPopup('OVERALL CRIME COUNT <br/> Community: '+ feature.properties.name + '<br> Type of Crime: ' + 'Property and Violent' + '<br> # of Related Crimes: ' + feature.properties.crimes).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="o1"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/services/cemeteries_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				console.log(response);
				
				removeLegends();
				map.addControl(htmlLegendCemetery);
				
				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: cemeteryPolyStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, name, steward

												
						layer.bindPopup('CEMETERY <br/> Name: '+ feature.properties.name + '<br> Steward: ' + feature.properties.steward).openPopup();
					}
				}).addTo(map);
				
				var layerBounds = queryLayer.getBounds();
				var bounds = map.getBounds();
				bounds.extend(layerBounds);
				map.flyToBounds(bounds);
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="o2"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/services/landfills_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendLandfills); 
				
				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: landfillStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, name, status, type

												
						layer.bindPopup('LANDFILL <br/> Name: '+ feature.properties.name + '<br> Status: ' + feature.properties.status + '<br> Type: ' + feature.properties.type).openPopup();
					}
				}).addTo(map);
				
				var layerBounds = queryLayer.getBounds();
				var bounds = map.getBounds();
				bounds.extend(layerBounds);
				map.flyToBounds(bounds);
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="o3")://Water treatment
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/safety/water_treatment_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendSewage); 
				
				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: waterTreatmentPolyStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, name, status, type

												
						layer.bindPopup('WATER TREATMENT LAGOON <br/> Name: '+ feature.properties.name + '<br> Type: ' + feature.properties.type + '<br> Acres: ' + feature.properties.acres).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="o4"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/safety/transportation_corridor_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendUtilities); 
				
				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: powerPolyStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, name, status, type

												
						layer.bindPopup('PIPELINE / POWER TRANSMISSION <br/> Plan Name: '+ feature.properties.planname + '<br> Status: ' + feature.properties.stage_dscr).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="o5"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/safety/railroad_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendRailways); 
				
				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: trainLineStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, name, status, type

												
						layer.bindPopup('RAILROAD <br/> Track Name: '+ feature.properties.trackname + '<br> Track Class: ' + feature.properties.trackclass + '<br> Track Use: ' + feature.properties.usetype).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="o6"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/safety/major_roads_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendMajRoads); 
				
				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: roadLineStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, name, status, type

												
						layer.bindPopup('MAJOR ROAD <br/> Road Name: '+ feature.properties.full_name + '<br> Road Class: ' + feature.properties.ctp_class).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="o7")://Zoning
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/safety/zoning_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendZoning); 
				
				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: commTypeStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, name, status, type

												
						layer.bindPopup('LAND USE / ZONING <br/> Community Name: '+ feature.properties.name + '<br> Class: ' + feature.properties.class).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	
	case (lName==="re1"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/realestate/sale_listings_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				removeLegends();
				map.addControl(htmlLegendHomeFS); 

				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: realEstateIcon});
					},
					onEachFeature: function (feature, layer) {
						//geom, name, type, address, grades
						//var str = feature.properties.city_postal;
						//var city = str.split(" ");

												
						//layer.bindPopup('REAL ESTATE <br/> Address: '+ feature.properties.address + '<br> City: ' + city[0] + '<br> Community: ' + feature.properties.community + '<br> List Price: ' + feature.properties.list_price + '<br>'+ template).openPopup();
						layer.on('click', popupSaveHandler);
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="re2"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/realestate/avg_house_price_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendAvgHouse);
				
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: avgHousePriceStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, name, status, type
 
												
						layer.bindPopup('AVERAGE HOUSE PRICE <br/> Community: '+ feature.properties.name + '<br> Average Listing Price: ' + feature.properties.avg_price + '<br> Listing Price Rank: ' + feature.properties.avg_price_rank + '<br> Number of Houses for Sale: ' + feature.properties.num_of_houses).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="s1"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/services/elem_schools_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendElemSchool); 
				
				//console.log(response);					
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: elemSchoolsIcon});
					},
					onEachFeature: function (feature, layer) {
						//geom, name, type, address, grades

												
						layer.bindPopup('ELEMENTARY SCHOOL <br/> Name: '+ feature.properties.name + '<br> Address: ' + feature.properties.address + '<br> Type: ' + feature.properties.type + '<br> Grades: ' + feature.properties.grades).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="s2"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/services/jr_high_schools_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendJrHighSchool); 
				
				//console.log(response);	
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: jrHighSchoolsIcon});
					},
					onEachFeature: function (feature, layer) {
						//geom, name, type, address, grades

												
						layer.bindPopup('JUNIOR HIGH SCHOOL <br/> Name: '+ feature.properties.name + '<br> Address: ' + feature.properties.address + '<br> Type: ' + feature.properties.type + '<br> Grades: ' + feature.properties.grades).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="s3"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/services/high_schools_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendHighSchool); 
				
				//console.log(response);	
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: highSchoolsIcon});
					},
					onEachFeature: function (feature, layer) {
						//geom, name, type, address, grades

												
						layer.bindPopup('HIGH SCHOOL <br/> Name: '+ feature.properties.name + '<br> Address: ' + feature.properties.address + '<br> Type: ' + feature.properties.type + '<br> Grades: ' + feature.properties.grades).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="s4"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/services/postsec_schools_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendPostSecSchool); 
				
				//console.log(response);	
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: postSecSchoolsIcon});
					},
					onEachFeature: function (feature, layer) {
						//geom, name, type

												
						layer.bindPopup('POST-SECONDARY SCHOOL <br/> Name: '+ feature.properties.name + '<br> Type: ' + feature.properties.type).openPopup();
					}
				}).addTo(map);
				
				var layerBounds = queryLayer.getBounds();
				var bounds = map.getBounds();
				bounds.extend(layerBounds);
				map.flyToBounds(bounds);
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="s5"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/services/bus_stops_transit_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendBusStop); 
				
				//console.log(response);	
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: busStopIcon});
					},
					onEachFeature: function (feature, layer) {
						//geom, stop_name, teleride
												
						layer.bindPopup('TRANSIT BUS STOP <br/> Stop Name: '+ feature.properties.stop_name + '<br> Teleride #: ' + feature.properties.teleride).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="s7"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/services/lrt_stops_transit_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendLRTStop); 
				
				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: lrtStationIcon});
					},
					onEachFeature: function (feature, layer) {
						//geom, stationnam, direction, route_num
												
						layer.bindPopup('LIGHT RAIL STATION <br/> Station Name: '+ feature.properties.stationnam + '<br> Direction: ' + feature.properties.direction + '<br> Route Number: ' + feature.properties.route).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="c2"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/services/com_centers_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendCommunityCenter); 
				
				//console.log(response);				
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: comCenterIcon});
					},
					onEachFeature: function (feature, layer) {
						//geom, name, address, type, community

												
						layer.bindPopup('COMMUNITY CENTER <br/> Name: '+ feature.properties.name + '<br> Address: ' + feature.properties.address + '<br> Type: ' + feature.properties.type + '<br> Community: ' + feature.properties.community).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="c1"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/entertainment/entertainment_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendAttraction); 
				
				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: entertainmentIcon});
					},
					onEachFeature: function (feature, layer) {
						//geom, name, address, type, community

												
						layer.bindPopup('ATTRACTION <br/> Name: '+ feature.properties.name + '<br> Address: ' + feature.properties.address + '<br> Type: ' + feature.properties.type + '<br> Community: ' + feature.properties.community).openPopup();
					}
				}).addTo(map);
				
				var layerBounds = queryLayer.getBounds();
				var bounds = map.getBounds();
				bounds.extend(layerBounds);
				map.flyToBounds(bounds);
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="c3"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/services/libraries_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendLibrary); 
				
				//console.log(response);				
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: librariesIcon});
					},
					onEachFeature: function (feature, layer) {
						//geom, name, address, type, community

												
						layer.bindPopup('LIBRARY <br/> Name: '+ feature.properties.name + '<br> Address: ' + feature.properties.address + '<br> Type: ' + feature.properties.type + '<br> Community: ' + feature.properties.community).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	
	case (lName==="sh1"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/entertainment/malls_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendShoppingMall); 

				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: mallIcon});
					},
					onEachFeature: function (feature, layer) {
						//geom, name, address, type, community

												
						layer.bindPopup('SHOPPING PLAZA <br/> Name: '+ feature.properties.tradename + '<br> Address: ' + feature.properties.address + '<br> Type: ' + feature.properties.licencetyp + '<br> Community: ' + feature.properties.comdistnm).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	
	case (lName==="sh4"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/entertainment/restaurants_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendRestaurant); 

				//console.log(response);				
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: restaurantIcon});
					},
					onEachFeature: function (feature, layer) {
						//geom, name, address, type, community

												
						layer.bindPopup('RESTAURANT <br/> Name: '+ feature.properties.tradename + '<br> Address: ' + feature.properties.address + '<br> Type: ' + feature.properties.licencetyp + '<br> Community: ' + feature.properties.comdistnm).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
case (lName==="sh5"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/entertainment/gas_stations_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendGasStation); 

				//console.log(response);				
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: gasStationIcon});
					},
					onEachFeature: function (feature, layer) {
						//geom, name, address, type, community

												
						layer.bindPopup('GAS STATION <br/> Name: '+ feature.properties.tradename + '<br> Address: ' + feature.properties.address + '<br> Type: ' + feature.properties.licencetyp + '<br> Community: ' + feature.properties.comdistnm).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	/*case (lName==="sh3"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/services/groceries_RA.php",*/
			/*data: {longitude: longitude, latitude: latitude},*//*
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendGroceryStore); 

				//console.log(response);	
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: librariesIcon});
					},
					onEachFeature: function (feature, layer) {
						//geom, name, address, type, community

												
						layer.bindPopup('LIBRARY <br/> Name: '+ feature.properties.name + '<br> Address: ' + feature.properties.address + '<br> Type: ' + feature.properties.type + '<br> Community: ' + feature.properties.community).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;*/
	case (lName==="d1"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/demographics/com_age_19_stats_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendDemoRed19); 

				//console.log(response);	
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: redStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, name, total_sum
												
						layer.bindPopup('UNDER 19 POPULATION <br/> Community: '+ feature.properties.name + '<br> Total Population Under 19: ' + feature.properties.total_sum + "<br/>% of Community Under 19:"+ feature.properties.total_style).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="d2"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/demographics/com_age_65_stats_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendDemoRed65); 

				//console.log(response);	
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: redStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, name, total_sum, male_sum, female_sum
												
						layer.bindPopup('OVER 65 POPULATION <br/> Community: '+ feature.properties.name + '<br> Total Population Over 65: ' + feature.properties.total_sum + '<br> Male Population Over 65: ' + feature.properties.male_sum + '<br> Female Population Over 65: ' + feature.properties.female_sum).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="d3"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/demographics/income_individual_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendIndivIncome); 

				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: indIncomeStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, edname2017,  orprov2_wi, orprov2_ucp, orprov2_ndp
												
						layer.bindPopup('INDIVIDUAL INCOME <br/> Community: '+ feature.properties.name + '<br> Median Individual Income: ' + feature.properties.income).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="d6"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/demographics/income_household_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendHouseIncome); 

				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: houseIncomeStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, edname2017,  orprov2_wi, orprov2_ucp, orprov2_ndp
												
						layer.bindPopup('HOUSEHOLD INCOME <br/> Community: '+ feature.properties.name + '<br> Median Household Income: ' + feature.properties.income).openPopup();					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="d5"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/demographics/prov_election_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: defaultPolyStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, edname2017,  orprov2_wi, orprov2_ucp, orprov2_ndp
												
						layer.bindPopup('PROVINCIAL ELECTION <br/> Name: '+ feature.properties.edname2017 + '<br> 2017 Winner: ' + feature.properties.orprov2_wi + '<br> UCP Vote Count: ' + feature.properties.orprov2_ucp + '<br> NDP Vote Count: ' + feature.properties.orprov2_ndp).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="r4"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/recreation/rec_parks_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendPark); 

				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: recParkPolyStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, type, steward, acres
												
						layer.bindPopup('RECREATIONAL PARK <br/> Type: '+ feature.properties.type + '<br> Steward: ' + feature.properties.steward + '<br> Area (acres): ' + feature.properties.acres).openPopup();
					}
				}).addTo(map);
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
	break;
	//Prov parks
case (lName==="r5"):
	map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/recreation/rec_prov_parks_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendProvPark); 

				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: recParkPolyStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, type, steward, acres
													
						layer.bindPopup('PROVINCIAL PARK <br/> Name: '+ feature.properties.oc_name + '<br> Area (acres): ' + feature.properties.acres).openPopup();
					}
				}).addTo(map);
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
	break;

case (lName==="r6"):
	map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/recreation/rec_trails_unpaved_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendRecTrails); 

				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: recTrailsLineStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, type, steward, acres
													
						layer.bindPopup('WALKING / BIKE TRAILS <br/> Type: '+ feature.properties.type + '<br> Status: ' + feature.properties.status + '<br> Steward: ' + feature.properties.steward).openPopup();
					}
				}).addTo(map);
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
	break;
	
	case (lName==="r1"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/recreation/rec_sports_surfaces_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendSportsFields); 

				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
						switch (feature.properties.asset_type) {
						case 'BALL DIAMOND': return L.marker(latlng, {icon: baseballIcon});
						case 'BASKETBALL': return L.marker(latlng, {icon: basketballIcon});
						case 'FOOTBALL': return L.marker(latlng, {icon: footballIcon});
						case 'FRISBEE GOLF': return L.marker(latlng, {icon: frisbeeIcon});
						case 'ICE ARENA': return L.marker(latlng, {icon: hockeyIcon});
						case 'TRACK AND FIELD': return L.marker(latlng, {icon: runnerIcon});
						case 'SKATING RINK': return L.marker(latlng, {icon: skateIcon});
						case 'SKATE PARK': return L.marker(latlng, {icon: banIcon});
						case 'TOBOGGAN HILL': return L.marker(latlng, {icon: sledIcon});
						case 'SOCCER': return L.marker(latlng, {icon: soccerIcon});
						case 'SOCCER OR FOOTBALL': return L.marker(latlng, {icon: socFootIcon});
						case 'TENNIS': return L.marker(latlng, {icon: tennisIcon});
						case 'VOLLEYBALL': return L.marker(latlng, {icon: volleyballIcon});					
					 }},
					 
					onEachFeature: function (feature, layer) {
						//geom, name, status, type
												
						layer.bindPopup('SPORTS FACILITY <br/> Type: '+ feature.properties.asset_type + '<br> Status: ' + feature.properties.life_cycle + '<br> Maintained By: ' + feature.properties.steward).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="r2"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/recreation/rec_water_facilities_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendWaterFacility); 

				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: waterSportIcon});
					},
					 
					onEachFeature: function (feature, layer) {
						//geom, name, status, type

												
						layer.bindPopup('WATER FACILITIES <br/> Name: '+ feature.properties.name + '<br> Type: ' + feature.properties.type + '<br> Address: ' + feature.properties.address).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="r3"): //Dog Parks
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/recreation/rec_parks_off_leash_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendDogPark); 

				//console.log(response);
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					style: dogParkStyle,
					 
					onEachFeature: function (feature, layer) {
						//geom, name, status, type

												
						layer.bindPopup('DOG PARK <br/> Name: '+ feature.properties.name + '<br> Address: ' + feature.properties.address + '<br> Status: ' + feature.properties.status + '<br> Fencing: ' + feature.properties.fencing + '<br> Maintained By: ' + feature.properties.maintained).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
	case (lName==="r7"):
    map.spin(true);
	$.ajax({
		type: "POST",
        url: "php/recreation/rec_playground_RA.php",
			/*data: {longitude: longitude, latitude: latitude},*/
			success:  function(response) {
				if(map.hasLayer(queryLayer)){					
					map.removeLayer(queryLayer);
				}
				
				removeLegends();
				map.addControl(htmlLegendPlayStructure); 
				
				addRemoveLayertoLegend();
				
				jslayer = JSON.parse(response);
				queryLayer = L.geoJson(jslayer, {
					 pointToLayer: function(feature, latlng) {
					
					return L.marker(latlng, {icon: playStructureIcon});
					},
					 
					onEachFeature: function (feature, layer) {
						//geom, name, status, type

												
						layer.bindPopup('PLAYGROUND <br/> Type: '+ feature.properties.type + '<br> Maintained By: ' + feature.properties.maintained + '<br> Status: ' + feature.properties.life_cycle).openPopup();
					}
				}).addTo(map);
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	}).done(function() {
		map.spin(false);
	});  
    break;
}}

function removeActiveLayer() {
	if(map.hasLayer(queryLayer)){					
	map.removeLayer(queryLayer);
	removeLegends();
	resetActiveLayerMenu();
	menuStatsFunction();
	
	activeLayerStats = null;
	
	map.invalidateSize(true);
	}
}
function resetActiveLayerMenu(){
	/*Clear active layers*/
	var links = document.querySelectorAll( 'a' );
		if(links !==null){
			for( var i=links.length; i--; ) {
			links[i].classList.remove("active");
			}
		}
	var links = document.querySelectorAll( 'div' );
		if(links !==null){
			for( var i=links.length; i--; ) {
			if(links[i].classList.contains("dropdown-content")){
				links[i].style.display="none";
			}
			}
		}
}
function addRemoveLayertoLegend(){
	//Add remove layer hyperlink to legend box
				var removeButton = document.createElement('span');
				removeButton.setAttribute('onclick',"removeActiveLayer();");
				removeButton.setAttribute('class',"removeActiveLayerButton");
				removeButton.onclick = function() {removeActiveLayer();}; // for IE
				removeButton.innerHTML = 'Remove Layer';
				var temp = document.getElementsByClassName('legend-block')[0].childNodes[0].childNodes[1];
				temp.appendChild(removeButton);
}

/*var statData;
function updateStats(){
	layerName=activeLayerStats;
	if (layerName ==null){}
	else{
		var longTemp = document.getElementById("longitude").value;
		var latTemp = document.getElementById("latitude").value;
		alert(layerName);
		
		$.ajax({
		type: "POST",
        url: "php/statistics/popupStatistics.php",
			data: {longitude: longTemp, latitude: latTemp, activeLay: layerName},
			success:  function(response) {
								
				statData = JSON.parse(response);
				console.log(response);
				
				//Get Object Keys
				var statKeys = Object.keys(statData[0]);
				console.log(statKeys);
				//Get column count
				var colCount = statKeys.length;
				//console.log(statKeys.length);
									
				//Get row count
				var rowCount = Object.keys(statData).length;
				//console.log(rowCount);
				
				//Get values
				//Object.values(statData[0])[0];
				
				//Build Table				
				var table = new Tabulator("#sideStatsTable", {
				layout:"fitColumns",
				//height:"600px",
				columns:[]
					
					});
				
				//Add Title Header
				for (let i = 0; i < colCount; i++) {
					table.addColumn({title:statKeys[i].toUpperCase(), field:statKeys[i]}, false);
				}
					
				//Add data
				table.addData(Object.values(statData))
					
				
				
				
				
			},
			error: function(xhr, status, error){
				map.spin(false);
				alert("ERROR:" +error);
			}
	})
	}
	
}*/
